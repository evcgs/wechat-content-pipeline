---
name: wechat-content-pipeline
description: "微信公众号内容生产流水线 - 完整的 9 步内容生产流程"
metadata:
  {
    "openclaw":
      {
        "emoji": "📱",
        "requires": { "bins": ["node", "npm"], "env": ["SERPAPI_KEY", "VOLCENGINE_API_KEY", "ARK_API_KEY", "WECHAT_APP_ID", "WECHAT_APP_SECRET"] },
      },
  }
---

# wechat-content-pipeline (OpenClaw Skill)

微信公众号内容生产流水线 - 完整的 9 步内容生产流程。

---

## 🚀 快速开始：启动引导流程

### 当用户说「帮我写一篇公众号文章」时

**立即给出引导提示：**

```
✅ 好的！我们来一起完成一篇公众号文章！

在开始之前，请告诉我一些信息：

1. 📝 文章主题/选题是什么？
   （例如：医学大模型、AI医疗、OpenClaw网关等）

2. 🎯 目标读者是谁？
   （例如：医疗行业从业者、医院管理者、技术人员等）

3. 📋 文章类型是？
   - A. 深度分析类
   - B. 行业观察类
   - C. 产品发布类
   - D. 案例分享类

4. 💡 有什么特别想强调的点吗？
   （可选）

请告诉我这些信息，我就可以开始按照完整流程生产文章了！
```

---

## 📋 输出物规范（重要！）

### 规范 1：选题推荐过程必须保存

**不仅要保存「选题确认」，还要保存「选题推荐过程」！**

**选题推荐过程文件应包含：**
1. 初始推荐：3个候选选题（含侧重点、钩子、亮点）
2. 第一轮推荐：我的建议 + 支持理由
3. 用户反馈：用户的疑问和反馈
4. 第二轮推荐：调整后的建议
5. 用户确认：用户的最终选择
6. 第三轮推荐：调整后的最终方案（完整结构）
7. 用户最终确认：用户确认继续

**文件命名格式：** `YYYY-MM-DD_主题_选题推荐过程.md`

---

### 规范 2：历史选题推荐过程必须补充保存

**所有历史选题的推荐过程都必须补充保存！**

- 对应到对应日期及主题
- 确保不丢失
- 作为资产沉淀，以便后续复用

---

### 规范 3：配图建议必须区分封面图和文内图

**配图建议的结构：**

1. **封面图**（放在最前面）
   - 风格
   - 画面描述
   - 尺寸（2560x1440，横幅，16:9）
   - 详细的生图提示词

2. **文内图 1-5**（按顺序）
   - 每个图的描述
   - 配色建议（可选）

---

### 规范 4：选题建议的结构

**选题建议的结构顺序：**

1. **我的建议**（放在最前面）
   - 推荐哪个选题
   - 支持理由（3-4条）

2. **选题 1**（含侧重点、钩子、亮点）
   - 🎯 侧重点：...
   - 🪝 钩子（开头场景）：...
   - 亮点：...

3. **选题 2**（含侧重点、钩子、亮点）
   - 🎯 侧重点：...
   - 🪝 钩子（开头场景）：...
   - 亮点：...

4. **选题 3**（含侧重点、钩子、亮点）
   - 🎯 侧重点：...
   - 🪝 钩子（开头场景）：...
   - 亮点：...

---

### 规范 5：每个选题必须有侧重点和钩子

**每个选题必须包含：**

- **🎯 侧重点：** 明确这个选题的核心角度
- **🪝 钩子（开头场景）：** 吸引人的开头场景描述
- **亮点：** 这个选题的亮点（3条左右）

**侧重点和钩子应该每个选题都不一样！**

---

### 规范 6：不要只发文件路径，要把生成后的内容直接发到聊天界面

**每一步完成后，必须：**

1. 保存文件到对应目录
2. **把生成后的内容直接发到聊天界面**
   - 文字内容直接发
   - 图片文件直接发（用 message 工具）
3. 告诉用户文件已保存

**不要只发文件路径！用户点击不了！**

---

### 规范 7：发布前先确认发布到哪个公众号

**发布前必须先询问用户：**

```
✅ 文章和配图都准备好了！

现在可以发布到微信公众号了。请确认要发布到哪个公众号：

1. wisediag（新公众号）
2. wisediag-old（旧公众号）
3. 两个都发布

请告诉我你的选择（1/2/3，或者直接说公众号名称）
```

**等待用户确认后，再执行发布操作！**

---

### 规范 8：重要更新要记录在 README.md 中

**每次重要更新后，必须：**

1. 在 README.md 开头添加「重要更新记录」部分
2. 记录本次的重要更新
3. 让用户可以看到本次做了什么重要更新
4. 更新说明要是非常重要的使用说明

---

### 规范 9：推送完成后必须带上远程项目地址

**推送完成后，在推送完成的结论中，必须：**

1. **带上远程项目的 GitHub 地址**
2. 格式：`**GitHub 仓库：** https://github.com/evcgs/wechat-content-pipeline`
3. 放在推送完成结论的最前面，方便用户打开
4. 让用户可以直接点击链接查看线上项目

---

### 规范 10：步骤5（写文章初稿）必须发送完整的详细文章内容，不能只发大纲总结 ⭐⭐⭐（最重要！）

**步骤5（写文章初稿）完成后，必须：**

1. **保存文件到对应目录**
2. **把完整的详细文章内容直接发到聊天界面**
   - ❌ **禁止：** 只发送大纲级别的总结（每部分只有1-3句话）
   - ❌ **禁止：** 把文章拆分成多个部分发送
   - ✅ **必须：** 发送完整的、详细的文章内容，包含所有段落、所有细节
   - ✅ **必须：** 文章内容要和文件中的内容完全一致
3. 告诉用户文件已保存

**为什么这很重要？**
- 用户需要看到完整的文章内容，才能进行审核和反馈
- 只发大纲总结会让用户误以为文章还没写完
- 违反了我们之前约定的规范6

---

## 📋 完整的输出物规范（10个规范）

1. **规范 1：** 选题推荐过程必须保存（作为资产沉淀）
2. **规范 2：** 历史选题推荐过程必须补充保存（确保不丢失）
3. **规范 3：** 配图必须区分封面图和文内图，封面图放在最前面
4. **规范 4：** 选题建议的结构优化（建议在最前面）
5. **规范 5：** 每个选题必须有侧重点和钩子
6. **规范 6：** 不要只发文件路径，要把生成后的内容直接发到聊天界面
7. **规范 7：** 发布前先确认发布到哪个公众号
8. **规范 8：** 重要更新要记录在 README.md 中
9. **规范 9：** 推送完成后必须带上远程项目地址
10. **规范 10：** 步骤5（写文章初稿）必须发送完整的详细文章内容，不能只发大纲总结 ⭐⭐⭐（最重要！）

---

### 用户提供信息后，确认并开始执行

**用户提供信息后，立即确认：**

```
✅ 收到！让我确认一下：

- 文章主题：[用户提供的主题]
- 目标读者：[用户提供的读者]
- 文章类型：[用户选择的类型]
- 特别强调：[用户提供的重点]

确认无误吗？如果没问题，我现在就开始：

1. 选题确认
2. 创意点提炼
3. 证据链整理
4. 大纲搭建
5. 写文章初稿
6. 搜索验证
7. 生成图片
8. 插入图片/更新文章
9. 发布前确认（询问发布到哪个公众号）

每一步完成后，我都会把结果发到聊天里给你看！
```

---

### 内置场景模板（可选）

为了让用户更容易开始，可以提供一些内置场景模板：

#### 场景 1：深度分析类
```
主题：医学大模型的「不可能三角」
目标读者：医疗行业从业者、医院管理者
类型：深度分析类
特别强调：可及性、质量、成本的平衡
```

#### 场景 2：产品发布类
```
主题：WiseDiag × OpenClaw 联合发布
目标读者：医疗行业客户、合作伙伴
类型：产品发布类
特别强调：双引擎架构、6个功能模块、4大场景
```

#### 场景 3：案例分享类
```
主题：卢旺达 Horizon1000 项目案例
目标读者：医疗行业从业者、投资者
类型：案例分享类
特别强调：云端AI、本地化培训、按效果付费
```

**同时支持两种方式：**
1. ✅ 作为 **OpenClaw 技能**使用（推荐）
2. ✅ 作为 **独立 Node.js 工具**使用

---

## 🔧 双模型架构说明

本项目采用**双模型分离架构**，文字生成和图片生成使用不同的模型，各自独立配置：

### 1. 文字生成模型（OpenClaw 配置）
- **用途：** 文章撰写、创意提炼、大纲搭建等文字类任务
- **配置位置：** OpenClaw 全局配置中的默认大模型
- **使用场景：** 步骤 1-6、步骤 8 的文字处理工作

### 2. 图片生成模型（技能独立配置）
- **用途：** 封面图、内文配图的生成
- **配置位置：** 技能独立配置文件 `config/config.json` 中的火山引擎（Volcengine）API
- **相关技能：** 本项目依赖 `volcengine-image-gen` 技能进行图片生成
- **使用场景：** 步骤 7 的图片生成工作

**为什么分开配置？**
- 文字和图片对模型的要求不同，分离可以灵活选择最适合的模型
- 图片生成通常需要更高的 API 配额，独立配置便于成本控制
- 可以单独更新/切换其中一个模型，不影响另一个的使用

---

## 完整内容生产工作流（9步）

```
1. 选题确认
   ↓
2. 创意点提炼（5个核心创意点+金句）
   ↓
3. 证据链整理（每个创意点2-3个证据+来源）
   ↓
4. 大纲搭建（三级大纲，约2500-3000字）
   ↓
5. 写文章（初稿）
   ↓
6. 搜索验证（SerpAPI搜索修正）
   ↓
7. 生成图片（火山引擎生图）
   ↓
8. 插入图片/更新文章
   ↓
9. 发布（微信公众号）
```

---

## 功能

- ✅ **搜索验证** - 使用 SerpAPI 搜索和获取网络信息
- ✅ **图片生成** - 使用火山引擎生成封面图和内文图
- ✅ **微信发布** - 使用 wenyan-cli 一键发布到微信公众号草稿箱
- ✅ **统一配置** - 一个配置文件管理所有密钥
- ✅ **统一入口** - 一个命令完成所有操作
- ✅ **安装验证** - 使用 `doctor` 命令验证安装是否成功
- ✅ **完整模板** - 9 步工作流的完整模板

---

## 方式 1: 作为 OpenClaw 技能使用（推荐）

### 安装步骤

1. **复制技能到 OpenClaw**

```bash
# 假设你的 OpenClaw workspace 在 ~/.openclaw/workspace
cp -r wechat-content-pipeline ~/.openclaw/workspace/skills/
```

2. **安装依赖**

```bash
cd ~/.openclaw/workspace/skills/wechat-content-pipeline
npm install
```

3. **安装 wenyan-cli（必需）**

```bash
npm install -g @wenyan-md/cli
wenyan --help
```

4. **配置**

```bash
cd ~/.openclaw/workspace/skills/wechat-content-pipeline
cp config/config.example.json config/config.json
```

编辑 `config/config.json`，填入你的 API 密钥。

5. **验证安装**

```bash
cd ~/.openclaw/workspace/skills/wechat-content-pipeline
node bin/wechat-pipeline.js doctor
```

### 在 OpenClaw 中使用

#### 完整流水线

```
"帮我运行完整流水线发布这篇文章"
+ 附带文章路径：./content/my-article.md
```

#### 分步使用

```
"帮我搜索验证这篇文章的信息"
+ 附带文章路径
```

```
"帮我生成这篇文章的配图"
+ 附带文章路径
```

```
"帮我发布这篇文章到微信公众号"
+ 附带文章路径
```

---

## 方式 2: 作为独立 Node.js 工具使用

### 安装步骤

1. **克隆仓库**

```bash
git clone https://github.com/evcgs/wechat-content-pipeline.git
cd wechat-content-pipeline
npm install
npm link  # 可选，全局链接命令
```

2. **安装 wenyan-cli（必需）**

```bash
npm install -g @wenyan-md/cli
wenyan --help
```

3. **配置**

```bash
cp config/config.example.json config/config.json
```

编辑 `config/config.json`，填入你的 API 密钥。

4. **验证安装**

```bash
wechat-pipeline doctor
```

### 使用命令行

```bash
# 查看帮助
wechat-pipeline --help

# 完整流水线（一条龙）
wechat-pipeline pipeline --article ./content/my-article.md

# 分步执行
wechat-pipeline search --article ./content/my-article.md
wechat-pipeline image --article ./content/my-article.md
wechat-pipeline publish --file ./content/my-article.md

# 单独使用
wechat-pipeline search --query "搜索关键词"
wechat-pipeline image --prompt "图片描述" --size 2560x1440 --type cover
wechat-pipeline publish --file ./content/my-article.md

# 配置管理
wechat-pipeline config --init
wechat-pipeline config --show
```

---

## 验证安装（重要！）

安装完成后，运行验证命令：

```bash
wechat-pipeline doctor
```

**成功输出示例：**
```
╔══════════════════════════════════════════════════════════╗
║           wechat-content-pipeline 安装验证                ║
╚══════════════════════════════════════════════════════════╝

✅ Node.js: v18.0.0
✅ npm: 9.0.0
✅ wenyan-cli: 1.0.0
✅ 项目依赖: 已安装
✅ 配置文件: config/config.json 已存在

✅ 所有检查通过！安装成功！

快速开始：
  wechat-pipeline --help
```

---

## 工作流模板（9步）

项目提供了完整的 9 步工作流模板，位于 `templates/workflow/` 目录：

| 步骤 | 模板文件 | 说明 |
|------|----------|------|
| 1 | `01-topic.md` | 选题确认模板 |
| 2 | `02-ideas.md` | 创意点提炼模板 |
| 3 | `03-evidence.md` | 证据链整理模板 |
| 4 | `04-outline.md` | 大纲搭建模板 |
| 5 | `05-article.md` | 文章初稿模板 |
| 6 | （无需模板） | 搜索验证（使用 wechat-pipeline search） |
| 7 | （无需模板） | 生成图片（使用 wechat-pipeline image） |
| 8 | `08-publish.md` | 发布版本模板（含 frontmatter） |
| 9 | （无需模板） | 发布（使用 wechat-pipeline publish） |

直接复制使用即可！

**⚠️ 重要提示（配图建议）：**
- 在**草稿版本**（步骤 5）中，可以在文章底部保留「配图建议」部分，用作生图的参考
- 在**正式发布版本**（步骤 8）中，需要去掉「配图建议」部分，只保留正文内容

---

## 项目结构

```
wechat-content-pipeline/
├── SKILL.md                # OpenClaw 技能说明（本文档）
├── README.md               # GitHub 项目说明
├── CONFIG.md               # 详细配置指南
├── QUICKSTART.md           # MVP 快速开始
├── WORKFLOW.md             # 完整 9 步工作流
├── package.json            # Node.js 配置
│
├── assets/                 # 图片资源
│   ├── group-qrcode.png   # 使用群二维码
│   └── personal-qrcode.png # 个人微信二维码
│
├── bin/                    # 可执行文件
│   └── wechat-pipeline.js # 主入口
│
├── src/                    # 源代码
│   ├── config/            # 配置管理
│   ├── search/            # 搜索模块
│   ├── image/             # 图片生成模块
│   ├── publish/           # 发布模块
│   └── pipeline/          # 流水线
│
├── config/                 # 配置文件
│   └── config.example.json # 配置模板
│
├── templates/              # 工作流模板
│   └── workflow/           # 9 步模板
│
├── examples/               # 示例
├── content/                # 文章目录（默认）
└── images/                 # 图片目录（默认）
```

---

## 更多文档

- [WORKFLOW.md](./WORKFLOW.md) - 完整 9 步内容生产工作流
- [README.md](./README.md) - GitHub 项目说明
- [CONFIG.md](./CONFIG.md) - 详细配置指南
- [QUICKSTART.md](./QUICKSTART.md) - MVP 快速开始
- [templates/workflow/](./templates/workflow/) - 工作流模板（9步）

---

## 致谢与声明

本项目整合了以下优秀的开源工具和服务：

### 核心依赖

- **[wenyan-cli](https://github.com/caol64/wenyan-cli)** - 微信公众号 Markdown 发布工具
  - 作者：caol64
  - License：Apache License 2.0
  - 用途：核心的微信公众号发布功能

- **[SerpAPI](https://serpapi.com)** - 网络搜索 API
  - 用途：搜索和获取网络信息

- **火山引擎 Ark Images API** - 图片生成 API
  - 用途：生成文章配图

### 开发框架

- **[Commander.js](https://github.com/tj/commander.js)** - 命令行界面开发
- **[Chalk](https://github.com/chalk/chalk)** - 终端彩色输出
- **[Inquirer.js](https://github.com/SBoudrias/Inquirer.js)** - 交互式命令行
- **[Ora](https://github.com/sindresorhus/ora)** - 终端加载动画

---

---

## 🔧 重要：修复后的工作流程（CRITICAL!）

### 问题修复记录

#### 问题 1：图片没有保存在对应目录 ✅ 已修复
**症状：**
- 图片生成在临时目录 `tmp/volcengine-image-gen-<timestamp>/`
- 但文章在 `wisediag-content/02_内容生产/草稿/`
- wenyan 工具在草稿文件夹找 images 子目录，但图片在上一级

**修复方案：**
1. 生成图片后，立即在文章所在目录创建 `images` 子文件夹
2. 把所有生成的 PNG 图片复制到该 `images` 子文件夹
3. 确保文章中的图片路径使用相对路径：`![](./images/001-xxx.png)`

---

#### 问题 2：连续性没有把生成后的内容发到聊天界面 ✅ 已修复
**症状：**
- 生成图片后，没有把图片直接发到聊天界面
- 生成文章后，没有把文章内容发到聊天界面
- 用户需要点击文件路径查看，但无法点击
- 用户多次反馈：「需要你把生成后的图文文件，在聊天窗口发我」

**修复方案：**
1. **每一步生成完成后，都要把结果发到聊天界面！**
   - 选题确认后 → 发送选题内容
   - 创意点提炼后 → 发送创意点内容
   - 证据链整理后 → 发送证据链内容
   - 大纲搭建后 → 发送大纲内容
   - 文章初稿后 → **发送完整文章内容**
   - 搜索验证后 → 发送验证报告
   - 图片生成后 → 发送每一张图片
   - 配图版文章后 → **发送完整配图版文章**
2. 发送每一张生成的图片
3. 同时发送文字说明，告知用户生成完成

---

#### 问题 3：发送图片时缺少 target 参数 ✅ 已修复
**症状：**
```
Action send requires a target.
```

**修复方案：**
1. **始终包含 `target` 参数！**
2. Target 格式：`chat:oc_500b66886af072e904575b2abe4177e0`（当前聊天 ID）
3. Channel：`feishu`（当前渠道）

**正确的 message 工具调用格式：**

```javascript
{
  "action": "send",
  "channel": "feishu",
  "target": "chat:oc_500b66886af072e904575b2abe4177e0",
  "message": "这是生成的文章：\n\n[文章内容...]",
  "media": "/path/to/image.png"  // 可选，用于发送图片
}
```

**发送文章内容的示例：**
```javascript
{
  "action": "send",
  "channel": "feishu",
  "target": "chat:oc_500b66886af072e904575b2abe4177e0",
  "message": "✅ 文章初稿已完成！\n\n[完整文章内容...]"
}
```

---

### 修复后的完整工作流（含启动引导）

```
用户说「帮我写文章」
    ↓
[引导] 给出引导提示，询问 4 个问题：
    1. 文章主题/选题
    2. 目标读者
    3. 文章类型（A/B/C/D）
    4. 特别强调的点（可选）
    ↓
用户提供信息
    ↓
[确认] 确认信息，告知即将开始的流程
    ↓
[执行步骤 1-9]
    ↓
    步骤 1：选题确认 → [发送] 选题内容
    ↓
    步骤 2：创意点提炼 → [发送] 创意点内容
    ↓
    步骤 3：证据链整理 → [发送] 证据链内容
    ↓
    步骤 4：大纲搭建 → [发送] 大纲内容
    ↓
    步骤 5：写文章初稿 → [发送] 完整文章内容
    ↓
    步骤 6：搜索验证 → [发送] 验证报告
    ↓
    步骤 7：生成图片 → [发送] 每一张图片
    ↓
    步骤 8：插入图片/更新文章 → [发送] 完整配图版文章
    ↓
    步骤 9：发布前确认 → [询问] 发布到哪个公众号？
    ↓
用户确认
    ↓
[发布] 执行发布操作
```

---

### 发布前交互流程（重要！）

在发布到微信公众号之前，**必须先询问用户**：

**询问格式示例：**

```
✅ 文章和配图都准备好了！

现在可以发布到微信公众号了。请确认要发布到哪个公众号：

1. wisediag（新公众号）
2. wisediag-old（旧公众号）
3. 两个都发布

请告诉我你的选择（1/2/3，或者直接说公众号名称）
```

**用户确认后，再执行发布操作。**

---

### 当前配置的公众号列表

根据 `wechat-accounts.json`：

| 账号名称 | AppID | 说明 |
|---------|-------|------|
| wisediag | wx334a2ae769398e79 | 新公众号（默认） |
| wisediag-old | wx38f7c5b274a58e3c | 旧公众号 |

---

### 关键检查清单（每次生成后必须检查）

- [ ] **用户说「帮我写文章」时，先给出引导提示！**
  - 询问 4 个问题：主题、读者、类型、重点
  - 提供内置场景模板（可选）
- [ ] **用户提供信息后，确认并告知流程！**
- [ ] **每一步完成后，都把结果内容发到聊天界面！**
- [ ] 图片已复制到文章所在目录的 `images` 子文件夹
- [ ] 文章中的图片路径使用相对路径：`![](./images/xxx.png)`
- [ ] 所有生成的图片已通过 `message` 工具发送到聊天界面
- [ ] 发送消息时**始终包含 `target` 参数**
- [ ] Target 格式正确：`chat:oc_500b66886af072e904575b2abe4177e0`
- [ ] **发布前必须先询问用户：发布到哪个公众号？**
  - 选项：wisediag / wisediag-old / 两个都发布
  - 等待用户确认后，再执行发布操作

---

## License

MIT
